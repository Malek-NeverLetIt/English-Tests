<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>اختبار اللغة الإنجليزية — الصف الثالث الإعدادي (المراجعات الإسبوعية 2)</title>
<style>
:root{
  --gold:#d4af37; --light:#fff8dc; --bg:#fffaf0; --dark:#3b2f1a;
  --success:#16a34a; --error:#dc2626; --accent:#b5892e;
}
*{box-sizing:border-box;font-family:'Tahoma','Noto Kufi Arabic',sans-serif}
body{margin:0;background:linear-gradient(180deg,var(--light),#fff1b8);color:var(--dark);text-align:center}
.container{max-width:820px;margin:auto;padding:18px}
.card{background:#fffef6;border:2px solid var(--gold);border-radius:14px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.12)}
.btn{background:linear-gradient(90deg,var(--gold),#fce07b);color:#31250c;border:none;padding:10px 16px;border-radius:10px;font-weight:700;cursor:pointer;transition:transform .12s}
.btn:hover{transform:scale(1.03)}
#startBtn{animation:pulse 2000ms infinite}
@keyframes pulse{0%,100%{box-shadow:0 0 8px rgba(212,175,55,.5)}50%{box-shadow:0 0 18px rgba(212,175,55,.9)}}
.question{text-align:right;margin:12px 0}
.qtext{font-weight:800;margin-bottom:10px}
label.choice{display:block;background:#fff;border:1px solid #eee;border-radius:8px;padding:10px;margin:8px 0;cursor:pointer;transition:background .12s}
label.choice:hover{background:#fff8e6}
.correct{background:#ecfdf5;border-color:#34d399}
.incorrect{background:#fff1f2;border-color:#fb7185}
.progress{height:8px;background:#f5e7ba;border-radius:99px;overflow:hidden;margin-top:10px}
.progress i{display:block;height:100%;background:var(--accent);width:0%;transition:width .4s}
.result{background:#fff8dc;margin-top:12px;padding:12px;border-radius:8px;border:1px solid var(--gold)}
.small{font-size:13px;color:#6b5b3a}
.hidden{display:none}
</style>

<!-- robust starter: this function ensures Start button always does something immediately -->
<script>
window.requestedStart = false;
function appStart(){
  window.requestedStart = true;
  // immediate UI reveal (works even if main script loads later)
  const s = document.getElementById('splash'); if(s) s.style.display = 'none';
  const app = document.getElementById('quizApp'); if(app) app.style.display = 'block';
  // if main initializer already present, call it
  if(typeof startApp === 'function'){ try{ startApp(); }catch(e){} return; }
  // otherwise poll briefly until startApp exists (for safety)
  let tries = 0;
  const t = setInterval(function(){
    if(typeof startApp === 'function'){ clearInterval(t); try{ startApp(); }catch(e){} }
    if(++tries>30) clearInterval(t);
  },80);
}
</script>
</head>
<body>

<!-- Splash -->
<div id="splash" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;background:linear-gradient(180deg,#fff8e1,#ffe9b0);z-index:99;padding:20px;">
  <h1 style="margin:6px 0 4px;font-size:20px;font-weight:900;color:var(--dark)">اختبار اللغة الإنجليزية — الصف الثالث الإعدادي (المراجعات الإسبوعية 2)</h1>
  <h3 style="margin:0 0 12px;color:#7b6a43">بإشراف الأستاذ باسم | تصميم: مالك</h3>
  <!-- direct onclick calls appStart (defined above) so button always works -->
  <button id="startBtn" class="btn" onclick="appStart()">ابدأ</button>
</div>

<!-- App (hidden by default) -->
<div id="quizApp" style="display:none;">
  <div class="container">
    <header style="margin-bottom:12px">
      <h1 style="margin:6px 0;font-size:18px;font-weight:900;color:var(--dark)">اختبار اللغة الإنجليزية — الصف الثالث الإعدادي (المراجعات الإسبوعية 2)</h1>
      <div class="small" style="margin-top:6px">بإشراف الأستاذ باسم | تصميم: مالك</div>
    </header>

    <main class="card" id="mainCard">
      <div class="progress"><i id="progBar"></i></div>
      <div id="qList" aria-live="polite"></div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <button class="btn" id="prevBtn">السابق</button>
        <div class="small">سؤال <span id="currentNum">0</span> / <span id="totalNum">0</span></div>
        <button class="btn" id="nextBtn">التالي</button>
      </div>

      <div style="margin-top:12px;display:flex;justify-content:flex-end">
        <button class="btn hidden" id="submitBtn">تصحيح</button>
      </div>

      <div id="resultArea" class="result hidden" role="status"></div>
    </main>
  </div>
</div>

<script>
/* === main app (defines startApp and everything) === */
(function(){

  // QUESTIONS (exact 5 you provided)
  const questions = [
    { q: 'ما معنى كلمة مرآة؟', choices: ['Book','Camp','Mirror','Brush'], answer: 2 },
    { q: 'ما معنى كلمة منفتح؟', choices: ['Introvert','Happy','Outgoing','Shy'], answer: 2 },
    { q: 'ما عكس كلمة Outgoing؟', choices: ['Happy','Sad','Introvert','Shy'], answer: 2 },
    { q: 'ما معنى كلمة Confidence؟', choices: ['سعادة','ثقة','قوة','إرادة'], answer: 1 },
    { q: 'ما معنى كلمة اكتشاف الذات؟', choices: ['Self-Respect','Self-Discovery','Curiosity','Resilience'], answer: 1 }
  ];

  // state + DOM
  window.current = 0;
  const total = questions.length;
  const qList = document.getElementById('qList');
  const currentNum = document.getElementById('currentNum');
  const totalNum = document.getElementById('totalNum');
  const progBar = document.getElementById('progBar');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const submitBtn = document.getElementById('submitBtn');
  const resultArea = document.getElementById('resultArea');

  totalNum.textContent = total;

  // audio (WebAudio synthesized) — safe: only plays after startApp user gesture
  let audioCtx = null;
  let soundsEnabled = false;
  function ensureAudio(){
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
  function tone(f1,f2,d){
    if(!soundsEnabled) return;
    try{
      ensureAudio();
      const o1 = audioCtx.createOscillator(), o2 = audioCtx.createOscillator(), g = audioCtx.createGain();
      o1.type='sine'; o2.type='sine';
      o1.frequency.value = f1; o2.frequency.value = f2;
      o1.connect(g); o2.connect(g); g.connect(audioCtx.destination);
      g.gain.setValueAtTime(0.015, audioCtx.currentTime);
      o1.start(); o2.start();
      g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + d);
      setTimeout(()=>{ try{ o1.stop(); o2.stop(); }catch(e){} }, d*1000);
    }catch(e){}
  }
  function clickFx(){ tone(520,640,0.07); }
  function successFx(){ tone(900,1200,0.45); }
  function failFx(){ tone(280,220,0.45); }

  // render single question
  function renderQuestion(i){
    qList.innerHTML = '';
    const item = questions[i];
    const div = document.createElement('div');
    div.className = 'question';
    div.innerHTML = `<div class="qtext">${i+1}. ${item.q}</div>`;
    item.choices.forEach((c,j)=>{
      const lab = document.createElement('label'); lab.className = 'choice';
      lab.innerHTML = `<input type="radio" name="q${i}" value="${j}"> ${c}`;
      const input = lab.querySelector('input');
      input.addEventListener('change', function(){
        localStorage.setItem('ans_'+i, j);
        try{ clickFx(); }catch(e){}
        updateProgress();
      });
      div.appendChild(lab);
    });
    qList.appendChild(div);
    currentNum.textContent = i+1;
    progBar.style.width = Math.round((i/total)*100) + '%';
    if(i === total-1) submitBtn.classList.remove('hidden'); else submitBtn.classList.add('hidden');
  }

  function updateProgress(){
    let answered = 0;
    for(let k=0;k<total;k++) if(localStorage.getItem('ans_'+k) != null) answered++;
    progBar.style.width = Math.round((answered/total)*100) + '%';
  }

  prevBtn.addEventListener('click', function(){ if(window.current>0){ window.current--; renderQuestion(window.current); }});
  nextBtn.addEventListener('click', function(){ if(window.current < total-1){ window.current++; renderQuestion(window.current); }});

  // show full correction with coloring
  submitBtn.addEventListener('click', function(){
    let score = 0;
    qList.innerHTML = '';
    questions.forEach((item,i) => {
      const raw = localStorage.getItem('ans_'+i);
      const chosen = raw !== null ? Number(raw) : null;
      const correct = (chosen === item.answer);
      if(correct) score++;
      const block = document.createElement('div');
      block.className = 'question ' + (correct ? 'correct' : 'incorrect');
      block.innerHTML = `<div class="qtext">${i+1}. ${item.q}</div>
        <div>إجابتك: <strong>${chosen!==null? item.choices[chosen] : '(بدون إجابة)'}</strong><br>
        الإجابة الصحيحة: <strong>${item.choices[item.answer]}</strong></div>`;
      qList.appendChild(block);
    });

    resultArea.classList.remove('hidden');
    resultArea.innerHTML = `<strong>درجتك النهائية: ${score}/${total}</strong><br><br><button class="btn" id="retryBtn">إعادة المحاولة 🔁</button>`;
    // sound rule: all correct -> success; 2+ wrong -> fail; exactly 1 wrong -> neutral click
    if(score === total) try{ successFx(); }catch(e){}
    else if(score <= total-2) try{ failFx(); }catch(e){}
    else try{ clickFx(); }catch(e){}

    // attach retry
    const retry = document.getElementById('retryBtn');
    if(retry) retry.addEventListener('click', resetQuiz);
  });

  function resetQuiz(){
    localStorage.clear();
    window.current = 0;
    resultArea.classList.add('hidden');
    // hide app and show splash again
    document.getElementById('quizApp').style.display = 'none';
    const s = document.getElementById('splash'); if(s) s.style.display = 'flex';
  }

  // startApp: called after user pressed appStart (guaranteed by appStart)
  window.startApp = function(){
    try{
      ensureAudio();
      // resume (some browsers keep suspended until resumed)
      if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{});
      soundsEnabled = true;
    }catch(e){}
    // if user already requested start (appStart set UI earlier), render
    renderQuestion(window.current || 0);
    updateProgress();
  };

  // if user clicked start before this script loaded, startApp will be called by appStart's poll
  if(window.requestedStart) startApp();

})(); // end IIFE
</script>
</body>
</html>
