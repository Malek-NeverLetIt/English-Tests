<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>اختبار اللغة الإنجليزية — الصف الثالث الإعدادي (المراجعات الأسبوعية 3)</title>
<style>
:root{
  --bg1:#0f1724;        /* deep navy */
  --glass: rgba(255,255,255,0.06);
  --card-bg: rgba(255,255,255,0.06);
  --accent:#60a5fa;     /* soft sky blue */
  --accent-2:#7dd3fc;
  --text:#e6eef8;
  --muted: rgba(230,238,248,0.7);
  --success:#86efac;
  --error:#fecaca;
  --btn-glass: rgba(255,255,255,0.08);
}
*{box-sizing:border-box;font-family:"Segoe UI","Noto Kufi Arabic",Tahoma,system-ui,-apple-system}
html,body{height:100%;margin:0;background:
  radial-gradient(1200px 600px at 10% 10%, rgba(96,165,250,0.08), transparent 10%),
  linear-gradient(180deg,var(--bg1), #071029); color:var(--text); -webkit-font-smoothing:antialiased;}
.app-wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}

/* Splash (glass) */
.splash{
  position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:80;
  background:linear-gradient(180deg, rgba(2,6,23,0.6), rgba(2,6,23,0.8));
  backdrop-filter: blur(6px);
}
.splashCard{
  width:100%;max-width:820px;padding:28px;border-radius:16px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.04);
  box-shadow: 0 18px 60px rgba(2,6,23,0.7);
  text-align:center;color:var(--text);
}
.title-main{font-weight:900;font-size:20px;color:var(--accent-2);margin:4px 0}
.title-sub{margin:6px 0 12px;color:var(--muted);font-size:14px}
.meta{font-size:13px;color:rgba(230,238,248,0.6);margin-bottom:14px}

/* Start button glassy */
.btn{
  display:inline-block;padding:12px 22px;border-radius:12px;border:none;font-weight:800;cursor:pointer;
  color:var(--bg1); background:linear-gradient(90deg,var(--accent),var(--accent-2));
  box-shadow: 0 10px 30px rgba(96,165,250,0.12); transition:transform .16s ease;
}
.btn:active{transform:translateY(2px)}

/* App card styles */
.container{width:100%;max-width:980px;margin:0 auto}
.header{display:flex;justify-content:space-between;align-items:center;padding:6px 0}
.h-left{text-align:right}
.h-left h1{margin:0;font-size:18px;font-weight:800;color:var(--accent-2)}
.h-left .meta2{font-size:13px;color:var(--muted);margin-top:6px}
.card{
  margin-top:14px;background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:14px;padding:18px;border:1px solid rgba(255,255,255,0.04);
  box-shadow:0 12px 40px rgba(2,6,23,0.6);
}

/* Questions */
.progress{height:10px;background:rgba(255,255,255,0.02);border-radius:999px;overflow:hidden;margin-bottom:12px}
.progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0%;transition:width .45s ease}
.question{margin:12px 0;padding:12px;border-radius:10px;background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.008));opacity:0;transform:translateY(8px);animation:fadeInUp .42s forwards}
@keyframes fadeInUp{to{opacity:1;transform:none}}
.qtext{font-weight:800;margin-bottom:10px;font-size:15px;color:var(--text)}
.choices{display:flex;flex-direction:column;gap:10px}
label.choice{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);cursor:pointer;background:rgba(255,255,255,0.01)}
label.choice:hover{background:rgba(255,255,255,0.02)}

/* result */
.result{margin-top:14px;padding:14px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.008));border:1px solid rgba(255,255,255,0.03)}
.correct{background:rgba(134,239,172,0.12);border-color:rgba(34,197,94,0.14)}
.incorrect{background:rgba(254,202,202,0.08);border-color:rgba(239,68,68,0.10)}

/* footer small */
.footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}

/* responsive */
@media (max-width:600px){
  .splashCard{padding:18px}
  .btn{padding:10px 16px}
  .qtext{font-size:14px}
}
</style>
</head>
<body>
<!-- Splash -->
<div class="splash" id="splash">
  <div class="splashCard" role="dialog" aria-labelledby="title">
    <div id="title" class="title-main">اختبار اللغة الإنجليزية — الصف الثالث الإعدادي (المراجعات الأسبوعية 3)</div>
    <div class="title-sub">— بإشراف الأستاذ باسم | تصميم: مالك —</div>
    <div class="meta">ملخص مراجعة سريع 3</div>
    <!-- guaranteed starter: calls appStart immediately (works even if main script loads later) -->
    <button id="startBtn" class="btn" onclick="appStart()">ابدأ</button>
  </div>
</div>

<!-- App -->
<div class="app-wrap" id="appRoot" style="visibility:hidden">
  <div class="container" id="quizApp" style="display:none">
    <div class="header">
      <div class="h-left">
        <h1>اختبار اللغة الإنجليزية — الصف الثالث الإعدادي (المراجعات الأسبوعية 3)</h1>
        <div class="meta2">بإشراف الأستاذ باسم | تصميم: مالك</div>
      </div>
      <div class="h-right" aria-hidden="true"></div>
    </div>

    <div class="card" id="mainCard" role="application">
      <div class="progress" aria-hidden="true"><i id="progBar"></i></div>
      <div id="qList" aria-live="polite"></div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <button class="btn" id="prevBtn">السابق</button>
        <div style="color:var(--muted)">سؤال <span id="currentNum">0</span> / <span id="totalNum">0</span></div>
        <button class="btn" id="nextBtn">التالي</button>
      </div>

      <div style="display:flex;justify-content:flex-end;margin-top:12px">
        <button class="btn" id="submitBtn" style="display:none">تصحيح</button>
      </div>

      <div id="resultArea" class="result" style="display:none" role="status"></div>
    </div>

    <div class="footer">بالتوفيق — اضغط "إعادة المحاولة" لإعادة الاختبار</div>
  </div>
</div>

<script>
/* ---------- Guaranteed starter: makes Start button always work ---------- */
window._requestedStart = false;
function appStart(){
  window._requestedStart = true;
  // show app UI immediately so user perceives instant response
  const splash = document.getElementById('splash'); if(splash) splash.style.display='none';
  const appRoot = document.getElementById('appRoot'); if(appRoot) appRoot.style.visibility='visible';
  const quizApp = document.getElementById('quizApp'); if(quizApp) quizApp.style.display='block';
  // try call startApp if defined; else poll until defined (robust)
  if(typeof startApp === 'function'){ try{ startApp(); }catch(e){} return; }
  let tries=0; const t = setInterval(()=>{ if(typeof startApp==='function'){ clearInterval(t); try{ startApp(); }catch(e){} } if(++tries>40) clearInterval(t); }, 80);
}

/* ---------- Main app (questions, rendering, audio) ---------- */
(function(){
  const questions = [
    {q:'ما معنى كلمة Sibling؟', choices:['إخوة / أشقاء','الأصدقاء','المدرسين','أولاد العم'], answer:0},
    {q:'ما معنى كلمة يحترم؟', choices:['respect','respectful','support','outside'], answer:0},
    {q:'ما معنى كلمة يدعم؟', choices:['connect','support','control','shape'], answer:1},
    {q:'ما معنى كلمة communicate؟', choices:['يرسم','يلاحظ','يتصل','منفتح'], answer:2},
    {q:'ما معنى كلمة connect؟', choices:['يعرف','هادئ','يحترم','يتصل'], answer:3},
    {q:'ما معنى كلمة يفهم؟', choices:['misunderstand','quiet','understand','relationship'], answer:2},
    {q:'ما معنى كلمة bond؟', choices:['رابطة','أصدقاء','عائلة','يتصل'], answer:0},
    {q:'ما معنى كلمة calm؟', choices:['هادئ','منشغل','مستعجل','غريب'], answer:0},
    {q:'ما معنى كلمة علاقة؟', choices:['relationship','connect','calm','conflict'], answer:0},
    {q:'ما معنى كلمة conflict؟', choices:['هادئ','رابطة','صراع','تعارف'], answer:2},
    {q:'صيغة الصفة من كلمة respect؟', choices:['supportive','misunderstand','respectful','connection'], answer:2},
    {q:'صيغة الصفة من كلمة support؟', choices:['understand','conflict','bond','supportive'], answer:3},
    {q:'عند تحويل كلمة communicate إلى اسم تكون:', choices:['connec + tion','communica + tion','understand + ing','support + ive'], answer:1},
    {q:'عند تحويل كلمة connect إلى اسم تكون:', choices:['support + ing','control + er','mis + understand','connec + tion'], answer:3},
    {q:'عكس كلمة understand أو كلمة عدم الفهم تعني:', choices:['supporting','understanding','connecting','misunderstanding'], answer:3},
    {q:'مرادف كلمة calm تعني quiet؟', choices:['نعم','لا'], answer:0},
    {q:'مضاد كلمة calm؟', choices:['quiet','calm','noisy','shape'], answer:2}
  ];

  // state + dom refs
  window.current = 0;
  const total = questions.length;
  const qList = document.getElementById('qList');
  const currentNum = document.getElementById('currentNum');
  const totalNum = document.getElementById('totalNum');
  const progBar = document.getElementById('progBar');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const submitBtn = document.getElementById('submitBtn');
  const resultArea = document.getElementById('resultArea');

  totalNum.textContent = total;

  /* ----- Audio (WebAudio) ----- */
  let audioCtx = null;
  let soundsEnabled = false;
  function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
  function playTone(freq1,freq2,dur){
    if(!soundsEnabled) return;
    try{
      ensureAudio();
      const o1 = audioCtx.createOscillator(), o2 = audioCtx.createOscillator(), g = audioCtx.createGain();
      o1.type='sine'; o2.type='sine';
      o1.frequency.value = freq1; o2.frequency.value = freq2;
      o1.connect(g); o2.connect(g); g.connect(audioCtx.destination);
      g.gain.setValueAtTime(0.014, audioCtx.currentTime);
      o1.start(); o2.start();
      g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
      setTimeout(()=>{ try{ o1.stop(); o2.stop(); }catch(e){} }, dur*1000);
    }catch(e){}
  }
  function clickFx(){ playTone(520,640,0.07); }
  function successFx(){ playTone(820,1200,0.45); }
  function failFx(){ playTone(300,220,0.45); }

  /* ----- render single question with fade-in animation ----- */
  function renderQuestion(i){
    qList.innerHTML = '';
    const item = questions[i];
    const card = document.createElement('div'); card.className = 'question';
    card.innerHTML = `<div class="qtext">${i+1}. ${item.q}</div>`;
    const choices = document.createElement('div'); choices.className = 'choices';
    item.choices.forEach((c,j)=>{
      const lab = document.createElement('label'); lab.className = 'choice';
      const input = document.createElement('input'); input.type = 'radio'; input.name = 'q'+i; input.value = j;
      input.style.marginInlineStart = '6px';
      input.addEventListener('change', ()=>{
        localStorage.setItem('ans_'+i, j);
        try{ clickFx(); }catch(e){}
        updateProgress();
      });
      lab.appendChild(input);
      lab.appendChild(document.createTextNode(' ' + c));
      choices.appendChild(lab);
    });
    card.appendChild(choices);
    qList.appendChild(card);
    // trigger animation (fade in)
    setTimeout(()=>{ card.style.opacity = '1'; card.style.transform = 'none'; }, 20);
    // update UI
    currentNum.textContent = i+1;
    progBar.style.width = Math.round((i/total)*100) + '%';
    if(i === total-1) submitBtn.style.display = 'inline-block'; else submitBtn.style.display = 'none';
  }

  function updateProgress(){
    let answered = 0;
    for(let k=0;k<total;k++) if(localStorage.getItem('ans_'+k) != null) answered++;
    progBar.style.width = Math.round((answered/total)*100) + '%';
  }

  prevBtn.addEventListener('click', ()=>{ if(window.current>0){ window.current--; renderQuestion(window.current); }});
  nextBtn.addEventListener('click', ()=>{ if(window.current < total-1){ window.current++; renderQuestion(window.current); }});

  /* ----- show correction with colored blocks ----- */
  submitBtn.addEventListener('click', ()=>{
    let score = 0;
    qList.innerHTML = '';
    questions.forEach((item,i)=>{
      const raw = localStorage.getItem('ans_'+i);
      const chosen = raw !== null ? Number(raw) : null;
      const ok = (chosen === item.answer);
      if(ok) score++;
      const block = document.createElement('div');
      block.className = 'question ' + (ok ? 'correct' : 'incorrect');
      block.innerHTML = `<div class="qtext">${i+1}. ${item.q}</div>
        <div>إجابتك: <strong>${chosen!==null ? item.choices[chosen] : '(بدون إجابة)'}</strong><br>
        الإجابة الصحيحة: <strong>${item.choices[item.answer]}</strong></div>`;
      qList.appendChild(block);
    });
    resultArea.style.display = 'block';
    resultArea.innerHTML = `<div style="font-weight:900;font-size:18px">درجتك النهائية: ${score}/${total}</div>
      <div style="margin-top:8px;color:var(--muted)">تم إنهاء الاختبار</div>
      <div style="margin-top:12px"><button class="btn" id="retryBtn">إعادة المحاولة 🔁</button></div>`;
    // play sound
    if(score === total) { try{ successFx(); }catch(e){} }
    else if(score <= total-2) { try{ failFx(); }catch(e){} }
    else { try{ clickFx(); }catch(e){} }
    // attach retry
    const retry = document.getElementById('retryBtn'); if(retry) retry.addEventListener('click', resetQuiz);
  });

  function resetQuiz(){
    localStorage.clear();
    window.current = 0;
    resultArea.style.display = 'none';
    document.getElementById('quizApp').style.display = 'block';
    document.getElementById('splash') && (document.getElementById('splash').style.display = 'none');
    renderQuestion(window.current);
  }

  /* ----- startApp: called once user pressed Start (appStart ensures UI shown) ----- */
  window.startApp = function(){
    try{
      // try enable audio (some browsers require resume)
      ensureAudio();
      if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume().catch(()=>{});
      soundsEnabled = true;
    }catch(e){}
    // show app if not visible
    const app = document.getElementById('quizApp'); if(app) app.style.display = 'block';
    document.getElementById('appRoot').style.visibility = 'visible';
    // render first
    renderQuestion(window.current || 0);
    updateProgress();
  };

  // if user tapped start earlier than script load, startApp will be called by appStart's poll
  if(window._requestedStart) { try{ startApp(); }catch(e){} }

})(); // end IIFE
</script>
</body>
</html>
